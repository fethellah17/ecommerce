{% extends 'store/main.html' %}
{% load static %}
{% block content %}

<div class="product-detail-container">
    <div class="product-detail">
        <div class="product-gallery">
            <div class="main-image" id="imageContainer">
                <img src="{{ product.imageURL }}" alt="{{ product.name }}" id="mainImage" class="zoomable-image">
                <div class="zoom-hint">Click to zoom</div>
            </div>
        </div>
        
        <div class="product-info-detail">
            {% if product.category %}
            <span class="product-category">{{ product.category.name }}</span>
            {% endif %}
            
            <h1 class="product-title">{{ product.name }}</h1>
            
            <div class="product-price-detail">
                {% if product.is_sale and product.sale_price %}
                <span class="original-price">{{ product.price }} DA</span>
                <span class="sale-price">{{ product.sale_price }} DA</span>
                <span class="discount-badge">SALE</span>
                {% else %}
                <span class="current-price">{{ product.price }} DA</span>
                {% endif %}
            </div>
            
            {% if product.description %}
            <div class="product-description">
                <p>{{ product.description }}</p>
            </div>
            {% endif %}
            
            <form method="POST" action="{% url 'update_cart' %}" class="add-to-cart-form">
                {% csrf_token %}
                <input type="hidden" name="productId" value="{{ product.id }}">
                <input type="hidden" name="action" value="add">
                
                {% if product.has_sizes %}
                <div class="size-selection">
                    <label>{{ product.get_size_label }}:</label>
                    <div class="size-options">
                        {% for size in product.get_sizes_list %}
                        <label class="size-option">
                            <input type="radio" name="size" value="{{ size }}" required>
                            <span>{{ size }}</span>
                        </label>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                
                <div class="quantity-selection">
                    <label>Quantity:</label>
                    <div class="quantity-input">
                        <button type="button" class="qty-decrease">-</button>
                        <input type="number" name="quantity" value="1" min="1" max="10" id="quantityInput">
                        <button type="button" class="qty-increase">+</button>
                    </div>
                </div>
                
                {% if request.user.is_authenticated %}
                    <button type="submit" class="btn-add-to-cart">Add to Cart</button>
                {% else %}
                    <a href="{% url 'login' %}" class="btn-add-to-cart" style="display: block; text-align: center; text-decoration: none;">Login to Add to Cart</a>
                {% endif %}
            </form>
            
            <div class="product-features">
                <div class="feature">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M0 3.5A1.5 1.5 0 0 1 1.5 2h9A1.5 1.5 0 0 1 12 3.5V5h1.02a1.5 1.5 0 0 1 1.17.563l1.481 1.85a1.5 1.5 0 0 1 .329.938V10.5a1.5 1.5 0 0 1-1.5 1.5H14a2 2 0 1 1-4 0H5a2 2 0 1 1-3.998-.085A1.5 1.5 0 0 1 0 10.5v-7z"/>
                    </svg>
                    <span>Free Shipping</span>
                </div>
                <div class="feature">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z"/>
                        <path fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z"/>
                    </svg>
                    <span>Easy Returns</span>
                </div>
                <div class="feature">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M5.338 1.59a61.44 61.44 0 0 0-2.837.856.481.481 0 0 0-.328.39c-.554 4.157.726 7.19 2.253 9.188a10.725 10.725 0 0 0 2.287 2.233c.346.244.652.42.893.533.12.057.218.095.293.118a.55.55 0 0 0 .101.025.615.615 0 0 0 .1-.025c.076-.023.174-.061.294-.118.24-.113.547-.29.893-.533a10.726 10.726 0 0 0 2.287-2.233c1.527-1.997 2.807-5.031 2.253-9.188a.48.48 0 0 0-.328-.39c-.651-.213-1.75-.56-2.837-.855C9.552 1.29 8.531 1.067 8 1.067c-.53 0-1.552.223-2.662.524z"/>
                    </svg>
                    <span>Secure Payment</span>
                </div>
            </div>
        </div>
    </div>
    
    {% if related_products %}
    <div class="related-products">
        <h3>Related Products</h3>
        <div class="related-grid">
            {% for item in related_products %}
            <a href="{% url 'product_detail' item.id %}" class="related-card">
                <img src="{{ item.imageURL }}" alt="{{ item.name }}">
                <h4>{{ item.name }}</h4>
                <span class="price">{{ item.price }} DA</span>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

<!-- Image Zoom Modal -->
<div id="imageModal" class="image-modal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <img id="modalImage" src="" alt="">
        <div class="zoom-controls">
            <button id="zoomIn">+</button>
            <button id="zoomOut">-</button>
            <button id="resetZoom">Reset</button>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const qtyInput = document.getElementById('quantityInput');
    const decreaseBtn = document.querySelector('.qty-decrease');
    const increaseBtn = document.querySelector('.qty-increase');
    
    // Quantity controls
    if (decreaseBtn && increaseBtn && qtyInput) {
        decreaseBtn.addEventListener('click', function() {
            let val = parseInt(qtyInput.value);
            if (val > 1) qtyInput.value = val - 1;
        });
        
        increaseBtn.addEventListener('click', function() {
            let val = parseInt(qtyInput.value);
            if (val < 10) qtyInput.value = val + 1;
        });
    }
    
    // Image zoom functionality
    const mainImage = document.getElementById('mainImage');
    const modal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
    const closeModal = document.querySelector('.close-modal');
    const zoomInBtn = document.getElementById('zoomIn');
    const zoomOutBtn = document.getElementById('zoomOut');
    const resetZoomBtn = document.getElementById('resetZoom');
    
    let currentZoom = 1;
    
    // Open modal when clicking on main image
    mainImage.addEventListener('click', function() {
        modal.style.display = 'flex';
        modalImage.src = this.src;
        modalImage.alt = this.alt;
        currentZoom = 1;
        modalImage.style.transform = `scale(${currentZoom})`;
        document.body.style.overflow = 'hidden';
    });
    
    // Close modal
    closeModal.addEventListener('click', function() {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    });
    
    // Close modal when clicking outside image
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
    });
    
    // Zoom controls
    zoomInBtn.addEventListener('click', function() {
        currentZoom = Math.min(currentZoom + 0.5, 3);
        modalImage.style.transform = `scale(${currentZoom})`;
    });
    
    zoomOutBtn.addEventListener('click', function() {
        currentZoom = Math.max(currentZoom - 0.5, 0.5);
        modalImage.style.transform = `scale(${currentZoom})`;
    });
    
    resetZoomBtn.addEventListener('click', function() {
        currentZoom = 1;
        modalImage.style.transform = `scale(${currentZoom})`;
    });
    
    // Keyboard controls
    document.addEventListener('keydown', function(e) {
        if (modal.style.display === 'flex') {
            switch(e.key) {
                case 'Escape':
                    modal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                    break;
                case '+':
                case '=':
                    currentZoom = Math.min(currentZoom + 0.5, 3);
                    modalImage.style.transform = `scale(${currentZoom})`;
                    break;
                case '-':
                    currentZoom = Math.max(currentZoom - 0.5, 0.5);
                    modalImage.style.transform = `scale(${currentZoom})`;
                    break;
                case '0':
                    currentZoom = 1;
                    modalImage.style.transform = `scale(${currentZoom})`;
                    break;
            }
        }
    });
});
</script>

{% endblock content %}
